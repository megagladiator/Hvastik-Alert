(()=>{var e={};e.id=5151,e.ids=[5151],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},71568:e=>{"use strict";e.exports=require("zlib")},58359:()=>{},93739:()=>{},81097:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>R,patchFetch:()=>U,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>x,staticGenerationAsyncStorage:()=>f});var s={};t.r(s),t.d(s,{DELETE:()=>g,GET:()=>d,POST:()=>p,PUT:()=>c});var o=t(73278),a=t(45002),n=t(54877),u=t(71309),i=t(66572);let l={"agentgl007@gmail.com":"admin"};async function d(e){try{let r=e.headers.get("authorization");if(console.log("Auth header:",r),!r||!r.startsWith("Bearer "))return console.log("No valid auth header"),u.NextResponse.json({error:"Unauthorized"},{status:401});let t=r.split(" ")[1];console.log("Token received:",t.substring(0,20)+"...");let{data:{user:s},error:o}=await i.RU.auth.getUser(t);if(console.log("Auth result:",{user:s?.email,error:o}),o||!s)return console.log("Auth failed:",o),u.NextResponse.json({error:"Unauthorized"},{status:401});if("agentgl007@gmail.com"!==s.email)return u.NextResponse.json({error:"Forbidden"},{status:403});let{searchParams:a}=new URL(e.url),n=a.get("email"),d=a.get("role"),p=a.get("status");console.log("Fetching users from Supabase...");let{data:c,error:g}=await i.RU.auth.admin.listUsers();if(console.log("Users fetch result:",{count:c?.users?.length,error:g}),g)return console.error("Error fetching users:",g),u.NextResponse.json({error:"Failed to fetch users"},{status:500});let m=c.users.map(e=>({id:e.id,email:e.email||"",name:e.user_metadata?.name||e.email||"",role:l[e.email||""]||"user",status:e.banned_until?"banned":"active",emailVerified:!!e.email_confirmed_at,createdAt:new Date(e.created_at),lastLoginAt:e.last_sign_in_at?new Date(e.last_sign_in_at):null}));return n&&(m=m.filter(e=>e.email.toLowerCase().includes(n.toLowerCase()))),d&&"all"!==d&&(m=m.filter(e=>e.role===d)),p&&"all"!==p&&(m=m.filter(e=>e.status===p)),u.NextResponse.json({users:m,total:m.length})}catch(e){return console.error("API error:",e),u.NextResponse.json({error:e.message},{status:500})}}async function p(e){return u.NextResponse.json({error:"User creation through admin panel is not supported. Users must register through the client application."},{status:400})}async function c(e){try{let r=e.headers.get("authorization");if(!r||!r.startsWith("Bearer "))return u.NextResponse.json({error:"Unauthorized"},{status:401});let t=r.split(" ")[1],{data:{user:s},error:o}=await i.RU.auth.getUser(t);if(o||!s)return u.NextResponse.json({error:"Unauthorized"},{status:401});if("agentgl007@gmail.com"!==s.email)return u.NextResponse.json({error:"Forbidden"},{status:403});let{id:a,email:n,name:d,role:p,status:c}=await e.json();if(p&&n&&(l[n]=p),c){let{error:e}=await i.RU.auth.admin.updateUserById(a,{ban_duration:"banned"===c?"876000h":"none"});if(e)return console.error("Error updating user status:",e),u.NextResponse.json({error:"Failed to update user status"},{status:500})}return u.NextResponse.json({message:"User updated successfully"})}catch(e){return console.error("API error:",e),u.NextResponse.json({error:e.message},{status:500})}}async function g(e){try{let r=e.headers.get("authorization");if(!r||!r.startsWith("Bearer "))return u.NextResponse.json({error:"Unauthorized"},{status:401});let t=r.split(" ")[1],{data:{user:s},error:o}=await i.RU.auth.getUser(t);if(o||!s)return u.NextResponse.json({error:"Unauthorized"},{status:401});if("agentgl007@gmail.com"!==s.email)return u.NextResponse.json({error:"Forbidden"},{status:403});let{searchParams:a}=new URL(e.url),n=a.get("id");if(!n)return u.NextResponse.json({error:"User ID is required"},{status:400});if(n===s.id)return u.NextResponse.json({error:"Cannot delete yourself"},{status:400});let{error:l}=await i.RU.auth.admin.deleteUser(n);if(l)return console.error("Error deleting user:",l),u.NextResponse.json({error:"Failed to delete user"},{status:500});return u.NextResponse.json({message:"User deleted successfully"})}catch(e){return console.error("API error:",e),u.NextResponse.json({error:e.message},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api-backup/users/route",pathname:"/api-backup/users",filename:"route",bundlePath:"app/api-backup/users/route"},resolvedPagePath:"D:\\DATA\\Hvastik-Alert\\app\\api-backup\\users\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:f,serverHooks:x}=m,R="/api-backup/users/route";function U(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:f})}},66572:(e,r,t)=>{"use strict";t.d(r,{RU:()=>n,c2:()=>u});var s=t(52418);let o="https://erjszhoaxapnkluezwpy.supabase.co",a=process.env.SUPABASE_SERVICE_ROLE_KEY,n=o&&a?(0,s.eI)(o,a,{auth:{autoRefreshToken:!1,persistSession:!1}}):null,u=n||{from:()=>({select:()=>({eq:()=>({order:()=>Promise.resolve({data:null,error:Error("Supabase not configured")}),single:()=>Promise.resolve({data:null,error:Error("Supabase not configured")})})}),insert:()=>({select:()=>Promise.resolve({data:null,error:Error("Supabase not configured")}),single:()=>Promise.resolve({data:null,error:Error("Supabase not configured")})}),update:()=>({eq:()=>({select:()=>Promise.resolve({data:null,error:Error("Supabase not configured")})})}),delete:()=>({eq:()=>Promise.resolve({data:null,error:Error("Supabase not configured")})})}),auth:{admin:{listUsers:()=>Promise.resolve({data:{users:[]},error:Error("Supabase not configured")}),getUserByEmail:()=>Promise.resolve({data:{user:null},error:Error("Supabase not configured")}),deleteUser:()=>Promise.resolve({data:null,error:Error("Supabase not configured")}),updateUserById:()=>Promise.resolve({data:null,error:Error("Supabase not configured")})}}}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[7787,4833,2418],()=>t(81097));module.exports=s})();