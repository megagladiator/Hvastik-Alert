(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[737],{5585:function(e,t,n){Promise.resolve().then(n.bind(n,9254))},9254:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return i}});var r=n(7437),a=n(2265),s=n(2141);function i(){let[e,t]=(0,a.useState)(null),[n,i]=(0,a.useState)(!0),[l,o]=(0,a.useState)([]),c="00000000-0000-0000-0000-000000000001",d=e=>{let t=new Date().toLocaleTimeString();o(n=>[...n,"[".concat(t,"] ").concat(e)])},u=async()=>{i(!0),d("Начинаем загрузку настроек...");try{if(!s.O){d("❌ Supabase не настроен");return}d("✅ Supabase настроен, делаем запрос к БД...");let{data:e,error:n}=await s.O.from("app_settings").select("*").eq("id",c).single();if(n){d("❌ Ошибка при загрузке: ".concat(n.message));return}e?(d("✅ Настройки загружены: ".concat(JSON.stringify(e,null,2))),t(e)):d("❌ Настройки не найдены")}catch(e){d("❌ Неожиданная ошибка: ".concat(e.message))}finally{i(!1)}},g=async()=>{d("Начинаем обновление настроек...");try{if(!s.O){d("❌ Supabase не настроен");return}let t=null==e?void 0:e.background_image_url,n="/kitten-dog-friendship.jpg"===t?"/adorable-looking-kitten-with-dog.jpg":"/kitten-dog-friendship.jpg";d("Текущий URL: ".concat(t)),d("Обновляем URL изображения на: ".concat(n));let r={background_image_url:n,updated_at:new Date().toISOString()};d("Данные для обновления: ".concat(JSON.stringify(r)));let{error:a}=await s.O.from("app_settings").update(r).eq("id",c);if(a){d("❌ Ошибка при обновлении: ".concat(a.message)),d("Детали ошибки: ".concat(JSON.stringify(a)));return}d("✅ Настройки обновлены в БД"),await u()}catch(e){d("❌ Неожиданная ошибка при обновлении: ".concat(e.message))}};return(0,a.useEffect)(()=>{u()},[]),(0,r.jsxs)("div",{className:"container mx-auto p-8",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Тест настроек фонового изображения"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"bg-gray-100 p-4 rounded-lg",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Текущие настройки"}),n?(0,r.jsx)("p",{children:"Загрузка..."}):e?(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"ID:"})," ",e.id]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Background Image URL:"})," ",e.background_image_url||"НЕ УСТАНОВЛЕН"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Darkening %:"})," ",e.background_darkening_percentage]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Updated At:"})," ",e.updated_at]}),e.background_image_url&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("p",{children:(0,r.jsx)("strong",{children:"Предварительный просмотр:"})}),(0,r.jsx)("img",{src:e.background_image_url,alt:"Background preview",className:"w-full h-32 object-cover rounded",onError:t=>{d("❌ Ошибка загрузки изображения: ".concat(e.background_image_url)),t.currentTarget.style.display="none"},onLoad:()=>d("✅ Изображение загружено: ".concat(e.background_image_url))})]})]}):(0,r.jsx)("p",{children:"Настройки не найдены"})]}),(0,r.jsxs)("div",{className:"bg-gray-100 p-4 rounded-lg",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Действия"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("button",{onClick:u,className:"w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"Обновить настройки"}),(0,r.jsx)("button",{onClick:g,className:"w-full bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600",children:"Установить новое изображение"}),(0,r.jsx)("button",{onClick:()=>{d("Отправляем событие settingsUpdated..."),window.dispatchEvent(new CustomEvent("settingsUpdated")),d("✅ Событие отправлено")},className:"w-full bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600",children:"Отправить событие settingsUpdated"}),(0,r.jsx)("button",{onClick:async()=>{d("Принудительно обновляем на другое изображение...");let e="/view-cats-dogs-being-friends.jpg";d("Устанавливаем: ".concat(e));let{error:t}=await s.O.from("app_settings").update({background_image_url:e,updated_at:new Date().toISOString()}).eq("id",c);t?d("❌ Ошибка: ".concat(t.message)):(d("✅ Принудительное обновление выполнено"),await u())},className:"w-full bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600",children:"Принудительное обновление"}),(0,r.jsx)("button",{onClick:async()=>{d("Тестируем upsert (вставка/обновление)...");let e="/adorable-looking-kitten-with-dog (1).jpg";d("Upsert с URL: ".concat(e));let{error:t}=await s.O.from("app_settings").upsert({id:c,background_image_url:e,background_darkening_percentage:30,updated_at:new Date().toISOString()});t?(d("❌ Ошибка upsert: ".concat(t.message)),d("Детали: ".concat(JSON.stringify(t)))):(d("✅ Upsert выполнен"),await u())},className:"w-full bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600",children:"Тест Upsert"})]})]})]}),(0,r.jsxs)("div",{className:"mt-6 bg-black text-green-400 p-4 rounded-lg",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Логи:"}),(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto",children:l.map((e,t)=>(0,r.jsx)("div",{className:"text-sm font-mono",children:e},t))})]})]})}},2141:function(e,t,n){"use strict";n.d(t,{O:function(){return s},e:function(){return i}});var r=n(6580);let a="https://erjszhoaxapnkluezwpy.supabase.co",s=a.includes("placeholder")?null:(0,r.eI)(a,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVyanN6aG9heGFwbmtsdWV6d3B5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzOTg2MjUsImV4cCI6MjA3MTk3NDYyNX0.IvgGGZDzq-7YJZAGWBeqcyR5BL1fc6zBrhMa1qiE5Rs",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,flowType:"pkce"},global:{headers:{"Content-Type":"application/json; charset=utf-8"}},db:{schema:"public"},realtime:{params:{eventsPerSecond:10}}}),i=s||{from:()=>({select:()=>({eq:()=>({order:()=>Promise.resolve({data:null,error:Error("Supabase not configured")}),single:()=>Promise.resolve({data:null,error:Error("Supabase not configured")})})}),insert:()=>({select:()=>Promise.resolve({data:null,error:Error("Supabase not configured")})}),update:()=>({eq:()=>({select:()=>Promise.resolve({data:null,error:Error("Supabase not configured")})})})}),storage:{from:()=>({upload:()=>Promise.resolve({data:null,error:Error("Supabase Storage not configured")}),getPublicUrl:()=>({data:{publicUrl:"/placeholder.svg"}})})}}}},function(e){e.O(0,[580,971,117,744],function(){return e(e.s=5585)}),_N_E=e.O()}]);