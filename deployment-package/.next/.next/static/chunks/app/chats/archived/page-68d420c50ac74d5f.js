(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[469],{9053:function(e,s,a){Promise.resolve().then(a.bind(a,3668))},3668:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return u}});var t=a(7437),r=a(2265),l=a(2869),n=a(6070),i=a(5974),c=a(5186),d=a(2660),x=a(3247),o=a(9334),m=a(9076),h=a(7648),j=a(2141);function u(){let[e,s]=(0,r.useState)([]),[a,u]=(0,r.useState)(!0),[g,v]=(0,r.useState)(""),[N,f]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{if(!j.O)return;let{data:{user:e}}=await j.O.auth.getUser();if(f(e),!e||"agentgl007@gmail.com"!==e.email){u(!1);return}try{let e=await fetch("/api/chats/archived");if(e.ok){let{data:a}=await e.json();console.log("Загружены архивированные чаты:",a),s(a||[])}else{let a=await e.json();console.error("Error fetching archived chats:",a),s([])}}catch(e){console.error("Error loading archived chats:",e),s([])}u(!1)})()},[]);let p=e.filter(e=>{var s,a;return(null===(s=e.pet)||void 0===s?void 0:s.name.toLowerCase().includes(g.toLowerCase()))||(null===(a=e.pet)||void 0===a?void 0:a.breed.toLowerCase().includes(g.toLowerCase()))}),b=async a=>{try{let t=await fetch("/api/chats/restore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatId:a,userId:null==N?void 0:N.id,isOwner:!0})});if(t.ok)s(e.filter(e=>e.id!==a)),alert("Чат восстановлен");else{let e=await t.json();alert("Ошибка: ".concat(e.error))}}catch(e){console.error("Ошибка восстановления чата:",e),alert("Ошибка при восстановлении чата")}},y=e=>{let s=new Date(e),a=Math.ceil(Math.abs(new Date().getTime()-s.getTime())/864e5);return 1===a?"Вчера":a<7?"".concat(a," дн. назад"):a<30?"".concat(Math.ceil(a/7)," нед. назад"):s.toLocaleDateString("ru-RU")};return N&&"agentgl007@gmail.com"!==N.email?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:(0,t.jsx)(n.Zb,{children:(0,t.jsxs)(n.aY,{className:"p-8 text-center",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Доступ запрещен"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"Только администраторы могут просматривать архивированные чаты"}),(0,t.jsx)(h.default,{href:"/chats",children:(0,t.jsx)(l.z,{className:"bg-blue-500 hover:bg-blue-600",children:"Вернуться к чатам"})})]})})})}):(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)(h.default,{href:"/chats",children:(0,t.jsxs)(l.z,{variant:"outline",size:"sm",children:[(0,t.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Назад к чатам"]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Архивированные чаты"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Управление архивированными чатами"})]})]})})})}),(0,t.jsxs)("div",{className:"container mx-auto px-4 py-6 max-w-4xl",children:[(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(x.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),(0,t.jsx)(c.I,{placeholder:"Поиск по архивированным чатам...",value:g,onChange:e=>v(e.target.value),className:"pl-10"})]})}),a?(0,t.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"}),(0,t.jsx)("span",{className:"ml-2 text-gray-600",children:"Загружаем архивированные чаты..."})]}):0===p.length?(0,t.jsx)(n.Zb,{children:(0,t.jsxs)(n.aY,{className:"p-8 text-center",children:[(0,t.jsx)(o.Z,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:g?"Архивированные чаты не найдены":"Нет архивированных чатов"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:g?"Попробуйте изменить поисковый запрос":"Архивированные чаты появятся здесь"})]})}):(0,t.jsx)("div",{className:"space-y-4",children:p.map(e=>{var s,a,r,c,d;return(0,t.jsx)(n.Zb,{className:"border-orange-200 bg-orange-50",children:(0,t.jsxs)(n.aY,{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("div",{className:"w-15 h-15 rounded-lg bg-orange-200 flex items-center justify-center",children:(0,t.jsx)(o.Z,{className:"h-6 w-6 text-orange-600"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"font-semibold text-gray-900",children:[null===(s=e.pet)||void 0===s?void 0:s.name," • ",null===(a=e.pet)||void 0===a?void 0:a.breed]}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["ID питомца: ",e.pet_id]}),(0,t.jsx)("p",{className:"text-xs text-orange-600",children:"\uD83D\uDCE6 Чат архивирован"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(i.C,{variant:(null===(r=e.pet)||void 0===r?void 0:r.type)==="lost"?"destructive":"default",className:(null===(c=e.pet)||void 0===c?void 0:c.type)==="lost"?"bg-red-100 text-red-800":"bg-green-100 text-green-800",children:(null===(d=e.pet)||void 0===d?void 0:d.type)==="lost"?"Потерялся":"Найден"}),(0,t.jsx)(i.C,{variant:"outline",className:"text-orange-600 border-orange-300",children:"Архивирован"})]})]}),e.last_message&&(0,t.jsxs)("div",{className:"mb-2",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 truncate",children:e.last_message.text}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:y(e.last_message.created_at)})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,t.jsxs)("span",{children:["Архивирован: ",y(e.archived_at)]}),(0,t.jsxs)("span",{children:["Создан: ",y(e.created_at)]})]})]})]}),(0,t.jsx)("div",{className:"flex items-center justify-end mt-4 pt-3 border-t border-orange-200",children:(0,t.jsxs)(l.z,{variant:"outline",size:"sm",onClick:()=>b(e.id),className:"text-green-600 border-green-300 hover:bg-green-50",children:[(0,t.jsx)(m.Z,{className:"h-4 w-4 mr-1"}),"Восстановить"]})})]})},e.id)})})]})]})}}},function(e){e.O(0,[580,432,972,105,971,117,744],function(){return e(e.s=9053)}),_N_E=e.O()}]);