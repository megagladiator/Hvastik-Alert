(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6853],{403:function(e,t,r){Promise.resolve().then(r.bind(r,2028))},2028:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return R}});var a=r(7437),l=r(2265),o=r(2869),n=r(5186),s=r(6815),i=r(4508);let c=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...l})});c.displayName="Textarea";var d=r(6070),u=r(3647),p=r(5309),m=r(519);let f=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)(p.fC,{className:(0,i.cn)("grid gap-2",r),...l,ref:t})});f.displayName=p.fC.displayName;let h=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)(p.ck,{ref:t,className:(0,i.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...l,children:(0,a.jsx)(p.z$,{className:"flex items-center justify-center",children:(0,a.jsx)(m.Z,{className:"h-2.5 w-2.5 fill-current text-current"})})})});h.displayName=p.ck.displayName;var g=r(8997),x=r(7689),b=r(9376),v=r(8190),y=r(2141);r(7380);let j=["image/jpeg","image/jpg","image/png","image/webp","image/gif"];function w(e){if(!j.includes(e.type))return{valid:!1,error:"Неподдерживаемый тип файла. Разрешены: ".concat(j.join(", "))};if(e.size>5242880){let t=(e.size/1048576).toFixed(1);return{valid:!1,error:"Файл слишком большой (".concat(t,"MB). Максимальный размер: ").concat("5","MB")}}return{valid:!0}}function N(e){return new Promise(t=>{let r=new Image,a=URL.createObjectURL(e);r.onload=()=>{if(URL.revokeObjectURL(a),r.width<100||r.height<100){t({valid:!1,error:"Изображение слишком маленькое (".concat(r.width,"x").concat(r.height,"px). Минимальный размер: ").concat(100,"x").concat(100,"px")});return}if(r.width>2048||r.height>2048){t({valid:!1,error:"Изображение слишком большое (".concat(r.width,"x").concat(r.height,"px). Максимальный размер: ").concat(2048,"x").concat(2048,"px")});return}t({valid:!0})},r.onerror=()=>{URL.revokeObjectURL(a),t({valid:!1,error:"Не удалось загрузить изображение для проверки"})},r.src=a})}function D(e){return new Promise((t,r)=>{let a=e.size;if(a<512e3){t(e);return}let l=1200,o=1200,n=.8;a>5242880?(l=800,o=800,n=.6):a>3145728?(l=1e3,o=1e3,n=.7):a>1048576?(l=1200,o=1200,n=.8):(l=1400,o=1400,n=.9),(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1200,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1200,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.8;return new Promise((l,o)=>{let n=document.createElement("canvas"),s=n.getContext("2d"),i=new Image;i.onload=()=>{let{width:c,height:d}=i,u=e.size,p=a,m=t,f=r;u>5242880?(m=800,f=800,p=.6):u>3145728?(m=1e3,f=1e3,p=.7):u>1048576&&(m=1200,f=1200,p=.8),c>d?c>m&&(d=d*m/c,c=m):d>f&&(c=c*f/d,d=f),n.width=c,n.height=d,null==s||s.drawImage(i,0,0,c,d),n.toBlob(t=>{t?l(new File([t],e.name,{type:"image/jpeg",lastModified:Date.now()})):o(Error("Ошибка сжатия изображения"))},"image/jpeg",p)},i.onerror=()=>o(Error("Ошибка загрузки изображения")),i.src=URL.createObjectURL(e)})})(e,l,o,n).then(t).catch(r)})}async function _(e){try{if(e.includes("supabase")||e.includes("storage.googleapis.com"))return e;if(e.startsWith("http")){if((await fetch(e,{method:"HEAD"})).ok)return e;return console.warn("⚠️ Внешний URL недоступен:",e),null}if(e.startsWith("/"))return await C(e);if(e.startsWith("data:"))return await S(e);return console.warn("⚠️ Неизвестный тип URL:",e),null}catch(e){return console.error("❌ Ошибка загрузки изображения в Supabase Storage:",e),null}}async function C(e){try{return console.log("⚠️ Локальный файл не может быть загружен в Supabase Storage:",e),null}catch(e){return console.error("❌ Ошибка загрузки локального файла:",e),null}}async function S(e){try{let t=await fetch(e),r=await t.blob(),a=new File([r],"image-".concat(Date.now(),".jpg"),{type:r.type}),l=w(a);if(!l.valid)throw console.error("❌ Валидация файла не пройдена:",l.error),Error(l.error);let o=await N(a);if(!o.valid)throw console.error("❌ Валидация размеров не пройдена:",o.error),Error(o.error);console.log("\uD83D\uDD04 Обрабатываем изображение...");let n=await D(a);n.size!==a.size?console.log("✅ Изображение сжато: ".concat((a.size/1024/1024).toFixed(1),"MB → ").concat((n.size/1024/1024).toFixed(1),"MB")):console.log("✅ Изображение не требует сжатия");let s=new FormData;s.append("file",n);let i=await fetch("/api/upload",{method:"POST",body:s});if(!i.ok)return console.error("❌ Ошибка загрузки data URL в Supabase Storage"),null;{let e=await i.json();return console.log("✅ Data URL загружен в Supabase Storage:",e.url),e.url}}catch(e){return console.error("❌ Ошибка обработки data URL:",e),null}}function R(){let e=(0,b.useRouter)(),{user:t,loading:r,isAuthenticated:i}=(0,v.B)(),[p,m]=(0,l.useState)(!1),[j,C]=(0,l.useState)({type:"lost",animal_type:"",breed:"",name:"",description:"",color:"",location:"",latitude:45.02063,longitude:37.50175,contact_phone:"",contact_name:"",reward:"",photo_url:""}),[S,R]=(0,l.useState)(null),[I,k]=(0,l.useState)(""),F=(0,b.useSearchParams)(),z=F.get("id"),E="admin"===F.get("from");(0,l.useEffect)(()=>{(async()=>{if(z&&y.e){let{data:t,error:r}=await y.e.from("pets").select("*").eq("id",z).single();if(t){var e;C({type:t.type||"lost",animal_type:t.animal_type||"",breed:t.breed||"",name:t.name||"",description:t.description||"",color:t.color||"",location:t.location||"",latitude:t.latitude||45.02063,longitude:t.longitude||37.50175,contact_phone:t.contact_phone||"",contact_name:t.contact_name||"",reward:(null===(e=t.reward)||void 0===e?void 0:e.toString())||"",photo_url:t.photo_url||""}),t.photo_url&&(t.photo_url.startsWith("http")||t.photo_url.startsWith("data:"))?(k(t.photo_url),console.log("Загружено изображение из базы данных:",t.photo_url)):k("")}}})()},[z]);let P=async r=>{r.preventDefault(),m(!0);try{let r=j.photo_url;if(S&&!r){console.log("⚠️ Есть выбранный файл, но нет URL. Файл мог не загрузиться.");try{let e=new FormData;e.append("file",S);let t=await fetch("/api/upload",{method:"POST",body:e});t.ok&&(r=(await t.json()).url,console.log("✅ Файл загружен повторно:",r))}catch(e){console.error("❌ Ошибка повторной загрузки файла:",e)}}if(r){var a;if(console.log("\uD83D\uDDBC️ Обработка изображения:",r),!(!(a=r)||a.startsWith("/")&&!a.startsWith("//")||a.startsWith("data:"))&&a.startsWith("http"))console.log("✅ URL подходит для продакшена:",r);else{console.log("\uD83D\uDD04 Загружаем изображение в Supabase Storage...");let e=await _(r);e?(r=e,console.log("✅ Изображение загружено в Supabase Storage:",r)):(r="https://via.placeholder.com/400x300/f3f4f6/9ca3af?text=No+Image",console.log("⚠️ Используем placeholder изображение:",r))}}console.log("\uD83D\uDDBC️ Финальный URL изображения:",{originalUrl:j.photo_url,finalPhotoUrl:r,selectedFile:null==S?void 0:S.name}),console.log("\uD83D\uDC64 Информация о пользователе:",{userId:null==t?void 0:t.id,userEmail:null==t?void 0:t.email,isAuthenticated:!!t});let l={...j,reward:j.reward?Number.parseInt(j.reward):null,status:"active",created_at:new Date().toISOString(),user_id:null==t?void 0:t.id,photo_url:r};console.log("\uD83D\uDCBE Сохраняем данные объявления:",{name:l.name,location:l.location,latitude:l.latitude,longitude:l.longitude,editId:z});try{let e=await fetch("/api/pets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({petData:l,userId:null==t?void 0:t.id,userEmail:null==t?void 0:t.email,editId:z||null})}),r=await e.json();if(!e.ok)throw Error(r.error||"Ошибка при сохранении объявления");z?alert("Объявление успешно обновлено!"):t?alert("Объявление успешно добавлено и привязано к вашему аккаунту!"):alert("Объявление успешно добавлено анонимно!")}catch(e){console.error("API error:",e),alert("Ошибка при сохранении объявления: ".concat(e.message))}E?e.push("/admin?tab=tables"):t?e.push("/cabinet"):e.push("/")}catch(r){console.error("Error adding pet:",r),alert("Произошла ошибка: ".concat(r.message)),E?e.push("/admin?tab=tables"):t?e.push("/cabinet"):e.push("/")}finally{m(!1)}},O=(e,t)=>{C(r=>({...r,[e]:t}))},U=async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r)try{if(!["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(r.type)){alert("❌ Неподдерживаемый тип файла. Разрешены: JPEG, PNG, WebP, GIF");return}console.log("\uD83D\uDD04 Обрабатываем изображение...");let e=await D(r);e.size!==r.size?console.log("✅ Изображение сжато: ".concat((r.size/1024/1024).toFixed(1),"MB → ").concat((e.size/1024/1024).toFixed(1),"MB")):console.log("✅ Изображение не требует сжатия");let t=w(e);if(!t.valid){alert("❌ ".concat(t.error));return}let a=await N(e);if(!a.valid){alert("❌ ".concat(a.error));return}R(e);let l=URL.createObjectURL(e);k(l);let o=new FormData;o.append("file",e);let n=await fetch("/api/upload",{method:"POST",body:o}),s=await n.json();n.ok?(C(e=>({...e,photo_url:s.url})),console.log("✅ Файл успешно загружен в Supabase:",s.url)):(console.error("❌ Ошибка загрузки файла:",s.error),console.log("\uD83D\uDCE4 Ответ сервера:",s),alert("❌ Ошибка загрузки файла. Попробуйте другое изображение."))}catch(e){console.error("Ошибка обработки файла:",e),alert("❌ Ошибка обработки файла. Попробуйте другое изображение.")}},B=async e=>{e.preventDefault();let t=e.dataTransfer.files[0];if(t&&t.type.startsWith("image/"))try{if(!["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(t.type)){alert("❌ Неподдерживаемый тип файла. Разрешены: JPEG, PNG, WebP, GIF");return}console.log("\uD83D\uDD04 Обрабатываем изображение...");let e=await D(t);e.size!==t.size?console.log("✅ Изображение сжато: ".concat((t.size/1024/1024).toFixed(1),"MB → ").concat((e.size/1024/1024).toFixed(1),"MB")):console.log("✅ Изображение не требует сжатия");let r=w(e);if(!r.valid){alert("❌ ".concat(r.error));return}let a=await N(e);if(!a.valid){alert("❌ ".concat(a.error));return}R(e);let l=URL.createObjectURL(e);k(l);let o=new FormData;o.append("file",e);let n=await fetch("/api/upload",{method:"POST",body:o}),s=await n.json();n.ok?(C(e=>({...e,photo_url:s.url})),console.log("✅ Файл успешно загружен в Supabase:",s.url)):(console.error("❌ Ошибка загрузки файла:",s.error),console.log("\uD83D\uDCE4 Ответ сервера:",s),alert("❌ Ошибка загрузки файла. Попробуйте другое изображение."))}catch(e){console.error("Ошибка обработки файла:",e),alert("❌ Ошибка обработки файла. Попробуйте другое изображение.")}},L=async()=>{let e=j.photo_url;if(e&&e.includes("supabase"))try{let t=e.split("/").pop();t&&(await fetch("/api/upload/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:t})}),console.log("Старый файл удален из Supabase Storage"))}catch(e){console.error("Ошибка при удалении файла:",e)}k(""),R(null),C(e=>({...e,photo_url:""}))},T=async e=>{if(console.log("\uD83D\uDE80 geocodeAddress вызвана с адресом:",e),!e.trim()){console.log("⚠️ Пустой адрес для поиска"),alert("Введите адрес для поиска");return}console.log("\uD83D\uDD0D Начинаем универсальное геокодирование адреса:",e);try{let t=e.trim().replace(/\s+/g," "),r=!1,a=[t,"".concat(t,", Краснодарский край, Россия"),"".concat(t,", Россия"),...G(t)?["станица ".concat(t,", Краснодарский край, Россия"),"село ".concat(t,", Краснодарский край, Россия"),"хутор ".concat(t,", Краснодарский край, Россия"),"поселок ".concat(t,", Краснодарский край, Россия")]:[],...t.includes("улица")||t.includes("ул.")||/^\d+/.test(t)?["".concat(t,", Анапа, Краснодарский край, Россия"),"".concat(t,", Новороссийск, Краснодарский край, Россия")]:[]];for(let t of(console.log("\uD83D\uDD0D Варианты поиска:",a),a)){if(r)break;console.log("\uD83D\uDD0D Пробуем поиск:",t);try{let a="https://nominatim.openstreetmap.org/search?format=json&q=".concat(encodeURIComponent(t),"&limit=1&addressdetails=1&countrycodes=ru"),l=await fetch(a);if(!l.ok){console.warn('⚠️ HTTP error для "'.concat(t,'": ').concat(l.status));continue}let o=await l.json();if(console.log("\uD83D\uDCE1 Ответ от Nominatim для:",t,o),o&&o.length>0){let a=o[0];C(e=>({...e,latitude:parseFloat(a.lat),longitude:parseFloat(a.lon)})),console.log("✅ Адрес найден через Nominatim:",{originalAddress:e,searchQuery:t,lat:a.lat,lon:a.lon,displayName:a.display_name}),alert("✅ Адрес найден!\n".concat(a.display_name,"\nКоординаты: ").concat(a.lat,", ").concat(a.lon)),r=!0;break}}catch(e){console.warn('⚠️ Ошибка поиска для "'.concat(t,'":'),e);continue}}if(!r){console.warn("⚠️ Адрес не найден через Nominatim, используем умное определение");let e=t.toLowerCase(),r=null,a="";e.includes("гостагаевская")?(r={lat:45.02063,lng:37.50175},a="Гостагаевская"):e.includes("варениковская")?(r={lat:45.12085,lng:37.64171},a="Варениковская"):e.includes("натухаевская")?(r={lat:45,lng:37.6},a="Натухаевская"):e.includes("новороссийск")?(r={lat:44.7239,lng:37.7708},a="Новороссийск"):e.includes("анапа")?(r={lat:44.8951,lng:37.3142},a="Анапа"):e.includes("краснодар")?(r={lat:45.0448,lng:38.976},a="Краснодар"):e.includes("сочи")?(r={lat:43.5855,lng:39.7231},a="Сочи"):e.includes("геленджик")&&(r={lat:44.5622,lng:38.0768},a="Геленджик"),r?(C(e=>({...e,latitude:r.lat,longitude:r.lng})),console.log("✅ Установлены координаты для ".concat(a,":"),r),alert("✅ Адрес не найден в базе, но установлены координаты для ".concat(a,"!\nКоординаты: ").concat(r.lat,", ").concat(r.lng))):(console.log("❌ Адрес не найден и нет координат по умолчанию"),alert("❌ Адрес не найден. Попробуйте ввести более точный адрес или укажите известный город/станицу."))}}catch(e){console.error("❌ Ошибка геокодирования:",e),alert("❌ Ошибка при поиске адреса. Попробуйте позже.")}},G=e=>{let t=e.toLowerCase().trim(),r=["станица","село","хутор","поселок","деревня","аул"].some(e=>t.includes(e)),a=["гостагаевская","кастанаевская","витязево","анапа"].some(e=>t.includes(e));return r||a};return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-orange-50",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(g.Z,{className:"h-6 w-6 text-orange-500"}),(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Подать объявление"})]})})}),(0,a.jsx)("div",{className:"container mx-auto px-4 py-6 max-w-2xl",children:(0,a.jsxs)(d.Zb,{children:[(0,a.jsxs)(d.Ol,{children:[(0,a.jsx)(d.ll,{children:z?"Редактировать объявление":"Новое объявление"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Заполните информацию о питомце, чтобы другие пользователи могли помочь"}),(0,a.jsx)("div",{className:"mt-2 text-xs text-gray-500",children:(null==t?void 0:t.email)?(0,a.jsxs)(a.Fragment,{children:["Вы добавляете объявление как: ",(0,a.jsx)("span",{className:"font-semibold",children:t.email})]}):(0,a.jsxs)(a.Fragment,{children:["Вы добавляете объявление ",(0,a.jsx)("span",{className:"font-semibold",children:"анонимно"})]})})]}),(0,a.jsx)(d.aY,{children:(0,a.jsxs)("form",{onSubmit:P,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(s._,{className:"text-base font-medium",children:"Тип объявления"}),(0,a.jsxs)(f,{value:j.type,onValueChange:e=>O("type",e),className:"flex gap-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(h,{value:"lost",id:"lost"}),(0,a.jsx)(s._,{htmlFor:"lost",className:"cursor-pointer",children:"Потерялся питомец"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(h,{value:"found",id:"found"}),(0,a.jsx)(s._,{htmlFor:"found",className:"cursor-pointer",children:"Найден питомец"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s._,{htmlFor:"animal_type",children:"Вид животного *"}),(0,a.jsxs)(u.Ph,{value:j.animal_type,onValueChange:e=>O("animal_type",e),children:[(0,a.jsx)(u.i4,{children:(0,a.jsx)(u.ki,{placeholder:"Выберите вид"})}),(0,a.jsxs)(u.Bw,{children:[(0,a.jsx)(u.Ql,{value:"dog",children:"Собака"}),(0,a.jsx)(u.Ql,{value:"cat",children:"Кошка"}),(0,a.jsx)(u.Ql,{value:"bird",children:"Птица"}),(0,a.jsx)(u.Ql,{value:"rabbit",children:"Кролик"}),(0,a.jsx)(u.Ql,{value:"other",children:"Другое"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s._,{htmlFor:"breed",children:"Порода *"}),(0,a.jsx)(n.I,{id:"breed",value:j.breed,onChange:e=>O("breed",e.target.value),placeholder:"Например: Лабрадор, Персидская",required:!0})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s._,{htmlFor:"name",children:"Кличка"}),(0,a.jsx)(n.I,{id:"name",value:j.name,onChange:e=>O("name",e.target.value),placeholder:"found"===j.type?"Неизвестно":"Кличка питомца"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s._,{htmlFor:"color",children:"Окрас *"}),(0,a.jsx)(n.I,{id:"color",value:j.color,onChange:e=>O("color",e.target.value),placeholder:"Например: Рыжий, Черно-белый",required:!0})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s._,{htmlFor:"description",children:"Описание *"}),(0,a.jsx)(c,{id:"description",value:j.description,onChange:e=>O("description",e.target.value),placeholder:"Подробное описание питомца, особые приметы, обстоятельства потери/находки...",rows:4,required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s._,{htmlFor:"location",children:"Место потери/находки *"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.I,{id:"location",value:j.location,onChange:e=>O("location",e.target.value),placeholder:"Например: Центральный пляж, ул. Ленина",required:!0,className:"flex-1"}),(0,a.jsx)(o.z,{type:"button",variant:"outline",onClick:e=>{e.preventDefault(),e.stopPropagation(),j.location.trim()?T(j.location):alert("Введите адрес для поиска")},title:"Найти адрес на карте",className:"min-w-[40px]",children:"\uD83D\uDD0D"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"\uD83D\uDD0D Нажмите кнопку поиска, чтобы найти адрес на карте"}),(0,a.jsxs)("p",{className:"text-xs text-blue-600",children:["\uD83D\uDCCD Координаты: ",j.latitude.toFixed(6),", ",j.longitude.toFixed(6)]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s._,{htmlFor:"contact_name",children:"Ваше имя *"}),(0,a.jsx)(n.I,{id:"contact_name",value:j.contact_name,onChange:e=>O("contact_name",e.target.value),placeholder:"Как к вам обращаться",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s._,{htmlFor:"contact_phone",children:"Телефон *"}),(0,a.jsx)(n.I,{id:"contact_phone",type:"tel",value:j.contact_phone,onChange:e=>O("contact_phone",e.target.value),placeholder:"+7 (918) 123-45-67",required:!0})]})]}),"lost"===j.type&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s._,{htmlFor:"reward",children:"Вознаграждение (необязательно)"}),(0,a.jsx)(n.I,{id:"reward",type:"number",value:j.reward,onChange:e=>O("reward",e.target.value),placeholder:"Сумма в рублях",min:"0"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s._,{htmlFor:"photo_url",children:"Фото питомца"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Поддерживаемые форматы: JPEG, PNG, WebP, GIF. Максимальный размер: 5MB. Рекомендуемое разрешение: 100x100 - 2048x2048px. Все изображения автоматически сжимаются для оптимизации."}),(0,a.jsx)("input",{id:"file-input",type:"file",accept:"image/*",onChange:U,className:"hidden"}),(0,a.jsx)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-orange-400 hover:bg-orange-50 transition-colors",onClick:()=>{let e=document.getElementById("file-input");null==e||e.click()},onDrop:B,onDragOver:e=>{e.preventDefault()},children:I?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("img",{src:I,alt:"Предпросмотр",className:"max-h-48 mx-auto rounded-lg object-cover",onError:()=>{k(""),C(e=>({...e,photo_url:""}))}}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)("p",{className:"text-sm text-green-600",children:"Фото выбрано! Нажмите для изменения"}),(0,a.jsx)(o.z,{type:"button",variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),L()},className:"text-xs",children:"Удалить"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.Z,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Перетащите фото сюда или нажмите для выбора"})]})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:"Или вставьте ссылку на фото:"}),(0,a.jsx)(n.I,{id:"photo_url",type:"url",value:j.photo_url,onChange:e=>{O("photo_url",e.target.value),e.target.value?(k(e.target.value),R(null)):k("")},placeholder:"https://example.com/photo.jpg",className:"text-sm"})]})]}),(0,a.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,a.jsx)(o.z,{type:"button",variant:"outline",className:"flex-1 bg-transparent",onClick:()=>{E?e.push("/admin?tab=tables"):t?e.push("/cabinet"):e.push("/")},children:"Отмена"}),(0,a.jsx)(o.z,{type:"submit",className:"flex-1 bg-orange-500 hover:bg-orange-600",disabled:p,children:z?p?"Сохраняем...":"Сохранить изменения":p?"Публикуем...":"Опубликовать объявление"})]})]})})]})})]})}},2869:function(e,t,r){"use strict";r.d(t,{d:function(){return i},z:function(){return c}});var a=r(7437),l=r(2265),o=r(7053),n=r(535),s=r(4508);let i=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=l.forwardRef((e,t)=>{let{className:r,variant:l,size:n,asChild:c=!1,...d}=e,u=c?o.g7:"button";return(0,a.jsx)(u,{className:(0,s.cn)(i({variant:l,size:n,className:r})),ref:t,...d})});c.displayName="Button"},6070:function(e,t,r){"use strict";r.d(t,{Ol:function(){return s},Zb:function(){return n},aY:function(){return c},ll:function(){return i}});var a=r(7437),l=r(2265),o=r(4508);let n=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...l})});n.displayName="Card";let s=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",r),...l})});s.displayName="CardHeader";let i=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",r),...l})});i.displayName="CardTitle",l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",r),...l})}).displayName="CardDescription";let c=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",r),...l})});c.displayName="CardContent",l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",r),...l})}).displayName="CardFooter"},5186:function(e,t,r){"use strict";r.d(t,{I:function(){return n}});var a=r(7437),l=r(2265),o=r(4508);let n=l.forwardRef((e,t)=>{let{className:r,type:l,...n}=e;return(0,a.jsx)("input",{type:l,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...n})});n.displayName="Input"},6815:function(e,t,r){"use strict";r.d(t,{_:function(){return c}});var a=r(7437),l=r(2265),o=r(6394),n=r(535),s=r(4508);let i=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)(o.f,{ref:t,className:(0,s.cn)(i(),r),...l})});c.displayName=o.f.displayName},3647:function(e,t,r){"use strict";r.d(t,{Bw:function(){return h},Ph:function(){return d},Ql:function(){return g},i4:function(){return p},ki:function(){return u}});var a=r(7437),l=r(2265),o=r(5377),n=r(875),s=r(2135),i=r(401),c=r(4508);let d=o.fC;o.ZA;let u=o.B4,p=l.forwardRef((e,t)=>{let{className:r,children:l,...s}=e;return(0,a.jsxs)(o.xz,{ref:t,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...s,children:[l,(0,a.jsx)(o.JO,{asChild:!0,children:(0,a.jsx)(n.Z,{className:"h-4 w-4 opacity-50"})})]})});p.displayName=o.xz.displayName;let m=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)(o.u_,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",r),...l,children:(0,a.jsx)(s.Z,{className:"h-4 w-4"})})});m.displayName=o.u_.displayName;let f=l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)(o.$G,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",r),...l,children:(0,a.jsx)(n.Z,{className:"h-4 w-4"})})});f.displayName=o.$G.displayName;let h=l.forwardRef((e,t)=>{let{className:r,children:l,position:n="popper",...s}=e;return(0,a.jsx)(o.h_,{children:(0,a.jsxs)(o.VY,{ref:t,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:n,...s,children:[(0,a.jsx)(m,{}),(0,a.jsx)(o.l_,{className:(0,c.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:l}),(0,a.jsx)(f,{})]})})});h.displayName=o.VY.displayName,l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)(o.__,{ref:t,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...l})}).displayName=o.__.displayName;let g=l.forwardRef((e,t)=>{let{className:r,children:l,...n}=e;return(0,a.jsxs)(o.ck,{ref:t,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(o.wU,{children:(0,a.jsx)(i.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(o.eT,{children:l})]})});g.displayName=o.ck.displayName,l.forwardRef((e,t)=>{let{className:r,...l}=e;return(0,a.jsx)(o.Z0,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",r),...l})}).displayName=o.Z0.displayName},8190:function(e,t,r){"use strict";r.d(t,{B:function(){return o}});var a=r(2265),l=r(2141);function o(){let[e,t]=(0,a.useState)(null),[r,o]=(0,a.useState)(null),[n,s]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{if((async()=>{if(!l.O){console.warn("Supabase client not initialized"),s(!1);return}try{let{data:{session:e},error:r}=await l.O.auth.getSession();r?console.error("Error getting session:",r):(t(e),o((null==e?void 0:e.user)||null))}catch(e){console.error("Failed to fetch session:",e)}s(!1)})(),l.O){let{data:{subscription:e}}=l.O.auth.onAuthStateChange(async(e,r)=>{console.log("Auth state changed:",e,r),t(r),o((null==r?void 0:r.user)||null),s(!1)});return()=>{null==e||e.unsubscribe()}}},[]),{session:e,user:r,loading:n,isAuthenticated:!!r}}},2141:function(e,t,r){"use strict";r.d(t,{O:function(){return o},e:function(){return n}});var a=r(6580);let l="https://erjszhoaxapnkluezwpy.supabase.co",o=l.includes("placeholder")?null:(0,a.eI)(l,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVyanN6aG9heGFwbmtsdWV6d3B5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzOTg2MjUsImV4cCI6MjA3MTk3NDYyNX0.IvgGGZDzq-7YJZAGWBeqcyR5BL1fc6zBrhMa1qiE5Rs",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,flowType:"pkce"},global:{headers:{"Content-Type":"application/json; charset=utf-8"}},db:{schema:"public"},realtime:{params:{eventsPerSecond:10}}}),n=o||{from:()=>({select:()=>({eq:()=>({order:()=>Promise.resolve({data:null,error:Error("Supabase not configured")}),single:()=>Promise.resolve({data:null,error:Error("Supabase not configured")})})}),insert:()=>({select:()=>Promise.resolve({data:null,error:Error("Supabase not configured")})}),update:()=>({eq:()=>({select:()=>Promise.resolve({data:null,error:Error("Supabase not configured")})})})}),storage:{from:()=>({upload:()=>Promise.resolve({data:null,error:Error("Supabase Storage not configured")}),getPublicUrl:()=>({data:{publicUrl:"/placeholder.svg"}})})}}},4508:function(e,t,r){"use strict";r.d(t,{cn:function(){return o}});var a=r(1994),l=r(3335);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,l.m6)((0,a.W)(t))}r(257)}},function(e){e.O(0,[6580,7432,635,9160,5278,2971,2117,1744],function(){return e(e.s=403)}),_N_E=e.O()}]);