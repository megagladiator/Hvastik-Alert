# Инструкции по исправлению ошибки на продакшене

## Проблема
На продакшене возникает ошибка "Unexpected token '<', "<!DOCTYPE "... is not valid JSON" при попытке сохранить объявление.

## Причина
Отсутствует переменная окружения `SUPABASE_SERVICE_ROLE_KEY` на продакшене.

## Решение

### 1. Добавить переменную окружения на продакшене

В настройках вашего хостинга (Vercel/Netlify/другой) добавьте:

```
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key_here
```

### 2. Получить Service Role Key

1. Перейдите в [Supabase Dashboard](https://supabase.com/dashboard)
2. Выберите ваш проект
3. Перейдите в **Settings** → **API**
4. Скопируйте **service_role** ключ (НЕ anon ключ!)

### 3. Проверить конфигурацию

После добавления переменной окружения, проверьте:

```
https://hvostikalert.ru/api/health
```

Должен вернуть:
```json
{
  "status": "ok",
  "environment": {
    "supabaseUrl": true,
    "supabaseServiceKey": true,
    "supabaseAnonKey": true
  }
}
```

### 4. Перезапустить приложение

После добавления переменной окружения перезапустите приложение на продакшене.

## Что было исправлено в коде

1. **Добавлена проверка переменных окружения** в `/api/pets`
2. **Улучшена обработка ошибок** с детальным логированием
3. **Добавлена проверка Content-Type** в клиентском коде
4. **Создан health endpoint** для диагностики

## Тестирование

После исправления:
1. Попробуйте создать объявление на продакшене
2. Проверьте консоль браузера на наличие ошибок
3. Убедитесь, что объявление сохраняется корректно

## Безопасность

⚠️ **Важно**: Service Role Key имеет полный доступ к базе данных. Не публикуйте его в публичных репозиториях!
